{"version":3,"sources":["../../../../server/api/foreclosedProperties/foreclosedProperties.controller.js"],"names":[],"mappings":"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","file":"foreclosedProperties.controller.js","sourcesContent":["/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/foreclosedPropertiess              ->  index\n */\n\n'use strict';\nvar publicConfig = {\n  key: 'AIzaSyAxF2aW5TWMiclJI5MdizMLBUFzXECbWM0',\n  stagger_time: 1000,\n  secure: true\n};\n\nvar $ = require('cheerio');\nvar _ = require('lodash');\nvar request = require('request');\nvar stringify = require('json-stringify-safe');\nvar GoogleMapsAPI = require('googlemaps');\nvar gmAPI = new GoogleMapsAPI(publicConfig);\n\n\n// Gets a list of ForeclosedPropertiess\nexports.index = function (req, res) {\n  var pdfArray = []\n\n  function gotHTML(err, resp, html) {\n    var counter = 0;\n    if (err) return console.error(err)\n    var parsedHTML = $.load(html)\n      // get all pdf tags and loop over them\n      console.log(parsedHTML('strong').slice(0).eq(0).text().split(' in '))\n    parsedHTML('a').map(function (i, link) {\n      var href = $(link).attr('href');\n      if (href) {\n        if (!href.match('.pdf')) return\n          // geocode API\n        pdfArray.push({\n          'PDFlink': domain + '/courts/2jd/kings/Civil/' + href,\n          'address': href.split('/')[2].replace(/-/g, ' ').replace(/.pdf/g, '') + ', Brooklyn, Ny',\n          'week': href.split('/')[1],\n          'auction_date': parsedHTML('strong').slice(2).eq(0).text(),\n          'time': parsedHTML('strong').slice(0).eq(0).text().split(' in ')[0],\n          'room': parsedHTML('strong').slice(0).eq(0).text().split(' in ')[1]\n        })\n      }\n    });\n    _.each(pdfArray, function (prop) {\n      var geocodeParams = {\n        \"address\": prop.address,\n        \"language\": \"en\",\n        \"region\": \"US\"\n      };\n\n      gmAPI.geocode(geocodeParams, function (err, result) {\n        if (!err) {\n          prop.formatedAddress = result.results[0];\n          var params = {\n            location: result.results[0].geometry.location.lat + ',' + result.results[0].geometry.location.lng,\n            size: '1600x1200',\n            heading: 108.4,\n            pitch: 7,\n            fov: 40\n          };\n          prop.formatedAddress.streetView = gmAPI.streetView(params);\n          counter++;\n          if (counter === pdfArray.length) {\n            res.json(pdfArray);\n          }\n        } else {\n          console.log(err);\n        }\n      });\n    })\n\n  }\n\n  var domain = 'http://www.nycourts.gov/courts/2jd/kings/civil/foreclosuresales.shtml'\n  request(domain, gotHTML)\n};\n"]}